<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Growth Potential Analyzer — AI Stocks & Mutual Funds</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    /* Subtle scrollbar styling */
    * { scrollbar-width: thin; }
    .drag-hover { outline: 2px dashed rgba(59,130,246,.6); outline-offset: 6px; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900">
  <div class="max-w-7xl mx-auto p-6">
    <header class="mb-6 flex items-center justify-between">
      <h1 class="text-2xl md:text-3xl font-bold">Growth Potential Analyzer <span class="text-slate-500">(AI Stocks & Mutual Funds)</span></h1>
      <div class="flex items-center gap-2">
        <button id="btnDemo" class="px-3 py-2 rounded-2xl bg-sky-600 text-white hover:bg-sky-700 shadow">Quick demo data</button>
        <button id="btnReset" class="px-3 py-2 rounded-2xl bg-white border border-slate-300 hover:border-slate-400 shadow">Reset</button>
      </div>
    </header>

    <!-- Timeframe Controls -->
    <section class="bg-white rounded-2xl shadow p-4 md:p-6 mb-6">
      <div class="grid md:grid-cols-5 gap-4 items-end">
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-1" for="startDate">Start date</label>
          <input id="startDate" type="date" class="w-full rounded-xl border-slate-300 focus:border-sky-500 focus:ring-sky-500" />
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-1" for="endDate">End date</label>
          <input id="endDate" type="date" class="w-full rounded-xl border-slate-300 focus:border-sky-500 focus:ring-sky-500" />
        </div>
        <div>
          <button id="btnAnalyze" class="w-full h-[42px] rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 shadow">Analyze</button>
        </div>
      </div>
      <p class="text-xs text-slate-500 mt-2">Tip: If you upload CSVs (Date, Close) per ticker, the app will auto-pick prices within the chosen timeframe. Otherwise, you can type start/end prices manually.</p>
    </section>

    <!-- Tabs -->
    <div class="mb-3 flex gap-2">
      <button data-tab="ai" class="tab-btn px-3 py-2 rounded-2xl bg-slate-200 hover:bg-slate-300 text-sm font-medium">AI Stocks</button>
      <button data-tab="mf" class="tab-btn px-3 py-2 rounded-2xl bg-slate-100 hover:bg-slate-200 text-sm font-medium">Mutual Funds</button>
    </div>

    <!-- Panels -->
    <section id="panel-ai" class="panel bg-white rounded-2xl shadow p-4 md:p-6 mb-6">
      <div class="flex flex-wrap items-center gap-2 mb-4">
        <input id="aiTicker" placeholder="Add AI stock ticker (e.g., NVDA)" class="rounded-xl border-slate-300 focus:border-sky-500 focus:ring-sky-500 px-3 py-2" />
        <button id="aiAdd" class="px-3 py-2 rounded-xl bg-sky-600 text-white hover:bg-sky-700">Add</button>
        <div class="text-xs text-slate-500">Drag & drop CSV onto a row, or use the upload button.</div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm" id="aiTable">
          <thead>
            <tr class="bg-slate-100 text-left">
              <th class="p-3">Ticker</th>
              <th class="p-3">Start Price</th>
              <th class="p-3">End Price</th>
              <th class="p-3">Total Return</th>
              <th class="p-3">CAGR</th>
              <th class="p-3">Sharpe* (opt.)</th>
              <th class="p-3">Data</th>
              <th class="p-3"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="text-xs text-slate-500 mt-2">*Sharpe shown if CSV uploaded (daily/monthly returns), risk‑free assumed 0 for simplicity.</p>
    </section>

    <section id="panel-mf" class="panel bg-white rounded-2xl shadow p-4 md:p-6 mb-6 hidden">
      <div class="flex flex-wrap items-center gap-2 mb-4">
        <input id="mfTicker" placeholder="Add mutual fund (e.g., VFIAX)" class="rounded-xl border-slate-300 focus:border-sky-500 focus:ring-sky-500 px-3 py-2" />
        <button id="mfAdd" class="px-3 py-2 rounded-xl bg-sky-600 text-white hover:bg-sky-700">Add</button>
        <div class="text-xs text-slate-500">Drag & drop CSV onto a row, or use the upload button.</div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm" id="mfTable">
          <thead>
            <tr class="bg-slate-100 text-left">
              <th class="p-3">Symbol</th>
              <th class="p-3">Start Price</th>
              <th class="p-3">End Price</th>
              <th class="p-3">Total Return</th>
              <th class="p-3">CAGR</th>
              <th class="p-3">Sharpe* (opt.)</th>
              <th class="p-3">Data</th>
              <th class="p-3"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="text-xs text-slate-500 mt-2">*Sharpe shown if CSV uploaded (daily/monthly returns), risk‑free assumed 0 for simplicity.</p>
    </section>

    <!-- Results & Charts -->
    <section class="bg-white rounded-2xl shadow p-4 md:p-6">
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h2 class="text-lg font-semibold mb-2">Ranking — Most Growth Potential</h2>
          <div class="text-xs text-slate-500 mb-3">Ranked by CAGR within the selected timeframe. Toggle to Sharpe if available.</div>
          <div class="flex items-center gap-2 mb-3">
            <label class="flex items-center gap-2 text-sm"><input type="radio" name="rankMetric" value="cagr" checked> CAGR</label>
            <label class="flex items-center gap-2 text-sm"><input type="radio" name="rankMetric" value="sharpe"> Sharpe</label>
          </div>
          <ol id="rankList" class="list-decimal ml-5 space-y-1 text-sm"></ol>
        </div>
        <div>
          <h2 class="text-lg font-semibold mb-2">Top CAGR Chart</h2>
          <canvas id="cagrChart" height="220"></canvas>
        </div>
      </div>
    </section>

    <footer class="text-xs text-slate-500 mt-6">
      <p>
        CSV format: columns <code>Date</code>, <code>Close</code>. The app picks prices closest to the selected dates and computes returns; if no CSV is present, it uses the typed prices.
      </p>
    </footer>
  </div>

  <script>
    /*** Utilities ***/
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const fmtPct = (x) => isFinite(x) ? (x*100).toFixed(2) + '%' : '—';
    const fmtNum = (x) => isFinite(x) ? Number(x).toFixed(2) : '';
    const daysBetween = (a,b) => Math.abs((b - a)/86400000);
    const yearsBetween = (a,b) => daysBetween(a,b)/365.25;

    // Parse CSV text into array of {date: Date, close: Number}
    function parseCSV(text) {
      const lines = text.trim().split(/\r?\n/);
      const header = lines.shift().split(',').map(h => h.trim().toLowerCase());
      const dIdx = header.indexOf('date');
      const cIdx = header.indexOf('close');
      if (dIdx === -1 || cIdx === -1) throw new Error('CSV must have Date and Close columns');
      const rows = [];
      for (const line of lines) {
        const parts = line.split(',');
        if (parts.length < Math.max(dIdx, cIdx)+1) continue;
        const d = new Date(parts[dIdx]);
        const c = parseFloat(parts[cIdx]);
        if (!isNaN(d) && isFinite(c)) rows.push({date: d, close: c});
      }
      rows.sort((a,b) => a.date - b.date);
      return rows;
    }

    // Pick price closest to target date within data
    function priceClosest(data, targetDate) {
      if (!data || !data.length) return null;
      let best = data[0];
      let bestDiff = Math.abs(data[0].date - targetDate);
      for (const r of data) {
        const diff = Math.abs(r.date - targetDate);
        if (diff < bestDiff) { best = r; bestDiff = diff; }
      }
      return best.close;
    }

    // Compute Sharpe from a series of closes (assumes equal spacing, rf=0)
    function computeSharpe(data) {
      if (!data || data.length < 3) return null;
      const rets = [];
      for (let i=1;i<data.length;i++) {
        const r = (data[i].close / data[i-1].close) - 1;
        if (isFinite(r)) rets.push(r);
      }
      if (rets.length < 2) return null;
      const avg = rets.reduce((a,b)=>a+b,0)/rets.length;
      const sd = Math.sqrt(rets.reduce((a,b)=>a+(b-avg)*(b-avg),0)/(rets.length-1));
      if (sd === 0 || !isFinite(sd)) return null;
      // Scale to annualized roughly (assuming ~252 trading days or 12 months). We'll infer cadence.
      const periods = data.length - 1;
      const days = (data.at(-1).date - data[0].date)/86400000;
      const perYear = days > 300 ? 252 : 12; // crude: if > 300 days, assume daily; else monthly
      const scale = Math.sqrt(perYear);
      return (avg/ sd) * scale;
    }

    /*** State ***/
    const state = {
      activeTab: 'ai',
      ai: [], // {ticker, start, end, csvData, sharpe}
      mf: [], // {symbol, start, end, csvData, sharpe}
      chart: null
    };

    /*** Tab handling ***/
    $$(".tab-btn").forEach(btn => btn.addEventListener('click', () => {
      state.activeTab = btn.dataset.tab;
      $$('#panel-ai, #panel-mf').forEach(p => p.classList.add('hidden'));
      $('#panel-'+state.activeTab).classList.remove('hidden');
      $$(".tab-btn").forEach(b => b.classList.toggle('bg-slate-200', b===btn));
      $$(".tab-btn").forEach(b => b.classList.toggle('bg-slate-100', b!==btn));
      render();
    }));

    /*** Row rendering helpers ***/
    function makeRow(item, type) {
      const tr = document.createElement('tr');
      tr.className = 'border-b last:border-0';
      tr.innerHTML = `
        <td class="p-3 font-medium">
          <span>${type==='ai'?item.ticker:item.symbol}</span>
        </td>
        <td class="p-3"><input class="price-input w-28 rounded-lg border-slate-300 px-2 py-1" placeholder="e.g., 100" value="${item.start ?? ''}"></td>
        <td class="p-3"><input class="price-input w-28 rounded-lg border-slate-300 px-2 py-1" placeholder="e.g., 150" value="${item.end ?? ''}"></td>
        <td class="p-3 return-cell text-slate-700">—</td>
        <td class="p-3 cagr-cell text-slate-700">—</td>
        <td class="p-3 sharpe-cell text-slate-700">${item.sharpe?.toFixed(2) ?? '—'}</td>
        <td class="p-3">
          <label class="inline-flex items-center gap-2 px-2 py-1 rounded-xl border border-slate-300 hover:bg-slate-50 cursor-pointer">
            <input type="file" accept=".csv" class="hidden file-input" />
            <span class="text-xs">Upload CSV</span>
          </label>
        </td>
        <td class="p-3 text-right">
          <button class="remove px-2 py-1 rounded-lg bg-rose-50 text-rose-700 hover:bg-rose-100">Remove</button>
        </td>
      `;

      // Drag & drop CSV
      tr.addEventListener('dragover', (e)=>{ e.preventDefault(); tr.classList.add('drag-hover'); });
      tr.addEventListener('dragleave', ()=> tr.classList.remove('drag-hover'));
      tr.addEventListener('drop', (e)=>{
        e.preventDefault(); tr.classList.remove('drag-hover');
        const file = e.dataTransfer.files?.[0];
        if (file) handleCSV(file, item, type, tr);
      });

      // File input
      tr.querySelector('.file-input').addEventListener('change', (e)=>{
        const file = e.target.files?.[0];
        if (file) handleCSV(file, item, type, tr);
      });

      // Inputs
      tr.querySelectorAll('.price-input').forEach((inp, idx)=>{
        inp.addEventListener('input', ()=>{
          const val = parseFloat(inp.value);
          if (type==='ai') {
            if (idx===0) item.start = val; else item.end = val;
          } else {
            if (idx===0) item.start = val; else item.end = val;
          }
          render();
        });
      });

      // Remove
      tr.querySelector('.remove').addEventListener('click', ()=>{
        const arr = type==='ai'? state.ai : state.mf;
        const i = arr.indexOf(item);
        if (i>-1) arr.splice(i,1);
        render();
      });

      return tr;
    }

    async function handleCSV(file, item, type, tr) {
      try {
        const text = await file.text();
        const data = parseCSV(text);
        item.csvData = data;
        // try compute Sharpe
        item.sharpe = computeSharpe(data);
        // auto-pick prices from timeframe
        const s = $('#startDate').value ? new Date($('#startDate').value) : null;
        const e = $('#endDate').value ? new Date($('#endDate').value) : null;
        if (s) item.start = priceClosest(data, s) ?? item.start;
        if (e) item.end = priceClosest(data, e) ?? item.end;
        render();
      } catch(err) {
        alert('CSV error: '+ err.message);
        console.error(err);
      }
    }

    /*** Render ***/
    function render() {
      const sVal = $('#startDate').value; const eVal = $('#endDate').value;
      const sDate = sVal ? new Date(sVal) : null;
      const eDate = eVal ? new Date(eVal) : null;
      const years = (sDate && eDate) ? Math.max(1/365.25, yearsBetween(sDate, eDate)) : null;

      // Tables
      const aiBody = $('#aiTable tbody'); aiBody.innerHTML = '';
      state.ai.forEach(item => {
        const tr = makeRow(item, 'ai');
        aiBody.appendChild(tr);
        // compute cells
        computeRow(tr, item, years);
      });

      const mfBody = $('#mfTable tbody'); mfBody.innerHTML = '';
      state.mf.forEach(item => {
        const tr = makeRow(item, 'mf');
        mfBody.appendChild(tr);
        computeRow(tr, item, years);
      });

      // Rankings
      updateRanking(years);
    }

    function computeRow(tr, item, years) {
      const start = parseFloat(item.start);
      const end = parseFloat(item.end);
      let total = NaN, cagr = NaN;
      if (isFinite(start) && isFinite(end) && start>0) {
        total = (end/start)-1;
        cagr = years? (Math.pow(end/start, 1/years) - 1) : total; // if no dates, show simple return
      }
      tr.querySelector('.return-cell').textContent = isFinite(total) ? fmtPct(total) : '—';
      tr.querySelector('.cagr-cell').textContent = isFinite(cagr) ? fmtPct(cagr) : '—';
      tr.querySelector('.sharpe-cell').textContent = (item.sharpe!=null && isFinite(item.sharpe)) ? item.sharpe.toFixed(2) : '—';
    }

    function collectAll() {
      const all = [
        ...state.ai.map(o=>({ name:o.ticker, start:o.start, end:o.end, sharpe:o.sharpe })),
        ...state.mf.map(o=>({ name:o.symbol, start:o.start, end:o.end, sharpe:o.sharpe }))
      ];
      return all.filter(x=>isFinite(x.start) && isFinite(x.end) && x.start>0);
    }

    function updateRanking(years) {
      const metric = document.querySelector('input[name="rankMetric"]:checked')?.value || 'cagr';
      const data = collectAll().map(x=>{
        const total = (x.end/x.start)-1;
        const cagr = years ? (Math.pow(x.end/x.start, 1/years) - 1) : total;
        return { ...x, total, cagr };
      });

      const ranked = data.filter(d=> isFinite(d[metric]) ).sort((a,b)=> b[metric]-a[metric]);
      const list = $('#rankList'); list.innerHTML = '';
      ranked.forEach((r, i)=>{
        const li = document.createElement('li');
        li.className = 'flex items-center justify-between bg-slate-50 rounded-xl px-3 py-2';
        li.innerHTML = `
          <span class="font-medium">${r.name}</span>
          <span class="text-slate-600">CAGR: ${fmtPct(r.cagr)} · Return: ${fmtPct(r.total)}${(r.sharpe!=null && isFinite(r.sharpe))?` · Sharpe: ${r.sharpe.toFixed(2)}`:''}</span>
        `;
        list.appendChild(li);
      });

      // Chart top 8 by CAGR
      const top = ranked.slice(0, 8);
      const labels = top.map(t=>t.name);
      const values = top.map(t=> t.cagr * 100);
      if (!state.chart) {
        const ctx = document.getElementById('cagrChart');
        state.chart = new Chart(ctx, {
          type: 'bar',
          data: { labels, datasets: [{ label: 'CAGR (%)', data: values }] },
          options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { ticks: { callback: (v)=> v + '%' } } } }
        });
      } else {
        state.chart.data.labels = labels;
        state.chart.data.datasets[0].data = values;
        state.chart.update();
      }
    }

    /*** Event wiring ***/
    $('#aiAdd').addEventListener('click', ()=>{
      const t = $('#aiTicker').value.trim().toUpperCase();
      if (!t) return;
      if (state.ai.some(x=>x.ticker===t)) return alert('Already added');
      state.ai.push({ ticker: t, start: '', end: '', csvData: null, sharpe: null });
      $('#aiTicker').value='';
      render();
    });

    $('#mfAdd').addEventListener('click', ()=>{
      const t = $('#mfTicker').value.trim().toUpperCase();
      if (!t) return;
      if (state.mf.some(x=>x.symbol===t)) return alert('Already added');
      state.mf.push({ symbol: t, start: '', end: '', csvData: null, sharpe: null });
      $('#mfTicker').value='';
      render();
    });

    $('#btnAnalyze').addEventListener('click', ()=> render());
    $$('input[name="rankMetric"]').forEach(r=> r.addEventListener('change', ()=> updateRanking($('#startDate').value && $('#endDate').value ? yearsBetween(new Date($('#startDate').value), new Date($('#endDate').value)) : null)) );

    $('#btnReset').addEventListener('click', ()=>{
      state.ai = [];
      state.mf = [];
      $('#startDate').value = '';
      $('#endDate').value = '';
      render();
    });

    // Demo data button: pre-fill a few tickers & example prices (illustrative only)
    $('#btnDemo').addEventListener('click', ()=>{
      $('#startDate').value = '2023-01-01';
      $('#endDate').value = '2025-10-01';
      state.ai = [
        { ticker:'NVDA', start: 150, end: 980 },
        { ticker:'MSFT', start: 240, end: 430 },
        { ticker:'GOOGL', start: 90, end: 180 },
        { ticker:'AMD', start: 65, end: 150 },
        { ticker:'META', start: 120, end: 500 }
      ];
      state.mf = [
        { symbol:'VFIAX', start: 350, end: 520 },
        { symbol:'VTSAX', start: 95, end: 145 },
        { symbol:'FSKAX', start: 110, end: 160 }
      ];
      render();
    });

    // Initialize with some empty rows to guide users
    (function init() {
      ['NVDA','MSFT','GOOGL'].forEach(t=> state.ai.push({ ticker:t, start:'', end:'', csvData:null, sharpe:null }));
      ['VFIAX','VTSAX'].forEach(t=> state.mf.push({ symbol:t, start:'', end:'', csvData:null, sharpe:null }));
      render();
    })();
  </script>
</body>
</html>
